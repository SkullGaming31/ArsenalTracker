# Clicking Warframe part checkboxes freezes the UI for >10s

**Labels:** need help

## Summary
When toggling the part checkboxes (neuroptics/chassis/systems/blueprint) on Warframe cards, the UI sometimes freezes for ~10 seconds before becoming responsive. This happens when clicking multiple checkboxes or toggling a single checkbox in some environments.

## Reproduction Steps
1. Run the app locally:
   - npm run dev
   - Open http://localhost:5173/
2. Navigate to `Warframes` page.
3. Open several Warframe cards and rapidly toggle the part checkboxes (or even toggle a single checkbox and observe).
4. Observe that the UI lags / freezes for a long period (~10s) before the checkbox's visual state and other UI updates settle.

## Expected behavior
Checkbox toggles should update instantly in the UI (sub-100ms). Persistence to disk (localStorage or other) should not block the main thread or freeze interactions.

## Actual behavior
UI becomes unresponsive for multiple seconds (observed ~10s) after toggling checkboxes. The checkbox eventually reflects the new state and changes get persisted to localStorage but only after the freeze ends.

## Environment
- OS: Windows (reported by user)
- Shell: pwsh.exe
- Node/npm environment: project uses Vite + Vue 3 + Pinia
- Repository: ArsenalTracker (branch: main)
- Key files: `src/components/WarframeCard.vue`, `src/stores/collection.ts` (persistence logic), `src/pages/Warframes.vue`

## What I've already tried / observed
- root cause appears to be synchronous localStorage writes triggered on each overrides change. localStorage.setItem is synchronous and expensive when called frequently. In the current code, `overrides` is watched and `saveToStorage()` is called on every change.
- A mitigation was implemented locally in the branch: debounced writes (200ms delay) to reduce blocking. This improved responsiveness in many cases but further improvements such as using IndexedDB or writing during idle time are possible.

## Relevant code snippets
- `src/stores/collection.ts` (persistence):

```ts
// before: immediate save on overrides change
watch(overrides, () => {
  saveToStorage()
}, { deep: true })

// after: debounced save (200ms)
let saveTimer: any = null
const saveDelay = 200
function scheduleSave() {
  if (saveTimer) clearTimeout(saveTimer)
  saveTimer = setTimeout(() => {
    saveToStorage()
    saveTimer = null
  }, saveDelay)
}
watch(overrides, () => scheduleSave(), { deep: true })
```

## Suggested fixes / mitigations
- Replace synchronous localStorage with asynchronous, non-blocking persistence:
  - Use IndexedDB (via `idb` or similar) for async storage and better performance for frequent writes.
  - Or batch/persist writes via requestIdleCallback or a WebWorker (note: workers cannot access window.localStorage directly; would need to postMessage results to main thread or use IndexedDB from worker).
- Keep an in-memory store for immediate UI updates and flush to persistence in the background.
- Debounce localStorage writes (already applied as a quick fix) to reduce frequency of expensive sync calls.

## Priority / Impact
High â€” blocks core user interactions and affects UX. Users expect instant feedback when toggling checkboxes.

## Additional notes
- If possible, attach a short screen recording showing the freeze and the browser console output (include timestamps). This helps reproduce under the same timing conditions.
- If the maintainers want, I can submit a PR to switch persistence to IndexedDB (adds `idb` dependency and migration) or implement a more robust background worker approach.

---
*Generated by local dev tooling on behalf of a user report.*
